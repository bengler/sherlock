#!/usr/bin/env ruby

require 'main'

ARGV.replace ['--help'] if ARGV.empty?

ENV['RACK_ENV'] ||= 'development'

Main do

  mode('reindex') do

    option('from=FROM') {
      argument :optional
      default 0
      description 'Index grove starting at post.id {n}'
    }

    def run
      puts "Indexing from post id #{params['from'].value}"
      require './lib/sherlock'

      # GroveIndexer.new.run ... or something
    end
  end

  mode('run') do
    def run

      Thread.abort_on_exception = true

      require './lib/sherlock'

      sherlock = Sherlock::Indexer.new
      sherlock.start

      sleep

    end
  end

end
